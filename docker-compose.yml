version: '3.8'

services:
  mongodb:
    image: mongo:latest
    container_name: mongodb
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
    ports:
      - "27017:27017"
    volumes:
      - ./MongoDB:/data/db

  server:
    build:
      context: ./ai-telegram-agent
      dockerfile: Dockerfile
    image: myapp/server:latest
    container_name: flask_server
    environment:
      MONGODB_URL: mongodb://admin:admin@mongodb:27017/
    depends_on:
      - mongodb
    volumes:
      - ./ai-telegram-agent/config.yml:/app/config.yml:ro
    ports:
      - "5001:5001"

  telegram:
    build:
      context: ./ai-telegram-agent
      dockerfile: Dockerfile.bot
    image: myapp/telegram:latest
    container_name: telegram_bot
    environment:
      MONGODB_URL: mongodb://admin:admin@mongodb:27017/
    depends_on:
      - mongodb
    volumes:
      - ./ai-telegram-agent/config.yml:/app/config.yml:ro

  front:
    build:
      context: ./ai-telegram-agent-front
      dockerfile: Dockerfile
    container_name: flutter_web
    ports:
      - "8080:80"